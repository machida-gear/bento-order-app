# 不足テーブル対応 - 簡易手順

## 現状

- **既存テーブル**: 10個
- **期待されるテーブル**: 13個
- **不足テーブル**: 3個

## 不足している3テーブル

1. `order_deadlines` - 日別締切時刻
2. `auto_order_templates` - 自動注文テンプレート
3. `auto_order_run_items` - 自動注文実行アイテム

## 実行が止まった原因

**外部キー制約の参照先テーブル名不一致**

- `order_deadlines` → `order_days` を参照（実際は `order_calendar`）
- `auto_order_templates` → `users_profile` と `menus` を参照（実際は `profiles` と `menu_items`）
- `auto_order_run_items` → `users_profile` を参照（実際は `profiles`）

## 対応方法

### 1. バックアップ取得（本番環境）

Supabase Dashboard → Database → Backups

### 2. SQL実行

**ファイル**: `007_create_missing_tables_production.sql`

Supabase SQL Editorで実行：
1. ファイルを開く
2. 内容をすべてコピー＆ペースト
3. 「Run」ボタンをクリック

### 3. 確認

```sql
-- テーブル数確認（13個になるはず）
SELECT COUNT(*) FROM information_schema.tables 
WHERE table_schema = 'public' AND table_type = 'BASE TABLE';

-- 新規テーブル確認
SELECT table_name FROM information_schema.tables 
WHERE table_schema = 'public' AND table_type = 'BASE TABLE'
AND table_name IN ('order_deadlines', 'auto_order_templates', 'auto_order_run_items');
```

## 詳細情報

- 詳細な分析: `不足テーブル分析結果_本番対応.md`
- 実行SQL: `supabase/migrations/007_create_missing_tables_production.sql`

