# 注文一覧機能の実装

このドキュメントでは、管理者向けの注文一覧機能の実装内容を記録します。

> 📖 **関連ドキュメント**: [README.md](./README.md) - すべてのドキュメントへの参照

---

## 実装概要

管理者が日付を指定して、その日のすべての注文を確認できる機能を実装しました。注文は業者別・メニュー別にグループ化され、注文時刻順で表示されます。

---

## 実装内容

### 1. 注文一覧ページの作成

#### ファイル

- `app/admin/orders/today/page.tsx`: 注文一覧ページ（サーバーコンポーネント）

#### 機能

- 日付を指定して注文一覧を取得・表示
- 業者別・メニュー別にグループ化
- 注文時刻順（新しい順）で表示
- 各業者・メニューの小計と全体の合計金額を表示
- Service Role Key を使用して RLS をバイパス

#### 表示形式

```
🏢 業者A
  🍱 メニュー1
    - 注文一覧（注文時刻順）
  🍱 メニュー2
    - 注文一覧（注文時刻順）
🏢 業者B
  🍱 メニュー3
    - 注文一覧（注文時刻順）
```

### 2. 日付選択カレンダーの実装

#### ファイル

- `app/admin/orders/today/date-calendar.tsx`: 日付選択カレンダーコンポーネント（クライアントコンポーネント）

#### 機能

- 月間カレンダー表示
- 注文がある日のみ選択可能（白背景、クリック可能）
- 注文がない日はグレーアウト表示（選択不可）
- 選択中の日付をハイライト表示（オレンジ背景）
- 今日の日付を特別表示（オレンジの薄い背景、「今日」ラベル）
- 月ナビゲーション（前月・次月ボタン、注文がある月のみ有効）
- 日付をクリックすると自動的にその日の注文一覧に遷移

#### 視覚的フィードバック

- **選択中**: オレンジ背景、太字
- **今日**: オレンジの薄い背景、「今日」ラベル
- **選択可能**: 白背景、ホバーでハイライト
- **選択不可**: グレー背景、透明度50%

### 3. ダッシュボードとの連携

#### ファイル

- `app/admin/page.tsx`: ダッシュボード

#### 機能

- 「本日の注文」カードをクリック可能に
- クリックで注文一覧ページに遷移
- アクティブユーザー、アクティブ業者、アクティブメニューのカードもクリック可能に

### 4. 管理画面メニューの変更

#### ファイル

- `components/admin-nav.tsx`: 管理画面ナビゲーション

#### 変更内容

- 「自動注文実行」メニューを削除
- 「注文一覧」メニューを追加（ダッシュボードとユーザー管理の間）

### 5. 各管理画面に「ダッシュボードに戻る」ボタンを追加

#### ファイル

- `app/admin/users/page.tsx`: ユーザー管理画面
- `app/admin/vendors/page.tsx`: 業者管理画面
- `app/admin/menus/page.tsx`: メニュー管理画面

#### 機能

- ヘッダー右側に「ダッシュボードに戻る」ボタンを追加
- 注文一覧画面と同じスタイルで統一

---

## 技術的な詳細

### データ取得

- Service Role Key を使用して RLS をバイパス
- 注文データ、ユーザー情報、メニュー情報、業者情報を結合
- 注文がある日付のリストを取得してカレンダーに表示

### グループ化ロジック

1. 注文データを注文時刻順（新しい順）でソート
2. 業者IDでグループ化
3. 各業者内でメニューIDでグループ化
4. 各メニュー内で注文時刻順で表示

### 日付選択の実装

- 注文がある日付のリストを取得
- Set を使用して高速検索
- カレンダー表示で注文がある日のみ選択可能
- 月ナビゲーションで前月・次月に移動（注文がある月のみ有効）

---

## 確認事項

- ✅ 管理者が日付を指定して注文一覧を確認できる
- ✅ 注文が業者別・メニュー別にグループ化されて表示される
- ✅ 注文時刻順（新しい順）で表示される
- ✅ カレンダーから日付を選択できる
- ✅ 注文がある日のみ選択可能
- ✅ ダッシュボードから注文一覧にアクセスできる
- ✅ 各管理画面からダッシュボードに戻れる

---

## 関連する変更

- `docs/CHANGELOG.md`: 変更履歴を追加
- `docs/PROGRESS.md`: 進捗状況を更新
- `docs/SPEC.md`: 仕様書を更新

---

最終更新日: 2025-01-XX
