# ä½æ‰€2è¡Œåˆ†å‰²ã¨PDFæ”¹å–„ã€ç›£æŸ»ãƒ­ã‚°å®Œå…¨å®Ÿè£…

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€ä½æ‰€ã‚’2è¡Œã«åˆ†å‰²ã™ã‚‹æ©Ÿèƒ½ã€PDFã¸ã®FAXç•ªå·è¿½åŠ ã€ç›£æŸ»ãƒ­ã‚°ã®å®Œå…¨å®Ÿè£…ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

> ğŸ“– **é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: [README.md](./README.md) - ã™ã¹ã¦ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¸ã®å‚ç…§

---

## å®Ÿè£…æ¦‚è¦

### å®Ÿè£…æ—¥

2025-01-XX

### å®Ÿè£…å†…å®¹

1. **ä½æ‰€ã‚’2è¡Œã«åˆ†å‰²ã™ã‚‹æ©Ÿèƒ½**
   - ã‚·ã‚¹ãƒ†ãƒ è¨­å®šç”»é¢ã§ä½æ‰€ã‚’2è¡Œã«åˆ†ã‘ã¦å…¥åŠ›å¯èƒ½ã«
   - PDFå‡ºåŠ›æ™‚ã«ä½æ‰€ã‚’2è¡Œã§è¡¨ç¤º
   - é•·æ–‡ã®ä¼æ¥­åãƒ»æ¥­è€…åãƒ»ä½æ‰€ã«å¯¾å¿œ

2. **PDFã«FAXç•ªå·ã‚’è¿½åŠ **
   - PDFç”Ÿæˆæ™‚ã«é€ä¿¡è€…æƒ…å ±ã«FAXç•ªå·ã‚’è¡¨ç¤º

3. **ç›£æŸ»ãƒ­ã‚°ã®å®Œå…¨å®Ÿè£…**
   - ã™ã¹ã¦ã®ç®¡ç†è€…æ“ä½œã‚’ç›£æŸ»ãƒ­ã‚°ã«è¨˜éŒ²

---

## ä½æ‰€ã‚’2è¡Œã«åˆ†å‰²ã™ã‚‹æ©Ÿèƒ½

### å®Ÿè£…ã®èƒŒæ™¯

PDFå‡ºåŠ›æ™‚ã«ã€ä½æ‰€ã‚„ä¼æ¥­åãŒé•·ã„å ´åˆã«å…¥ã‚Šãã‚‰ãªã„å•é¡ŒãŒç™ºç”Ÿã—ã¦ã„ã¾ã—ãŸã€‚ã¾ãŸã€ä½æ‰€ã‚’2è¡Œã«åˆ†ã‘ã¦è¨˜è¼‰ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚

### å®Ÿè£…å†…å®¹

#### 1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

**ãƒ•ã‚¡ã‚¤ãƒ«**: `supabase/migrations/058_split_company_address_to_two_columns.sql`

- `company_address1`ã‚«ãƒ©ãƒ ã‚’è¿½åŠ ï¼ˆæ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚’ç§»è¡Œï¼‰
- `company_address2`ã‚«ãƒ©ãƒ ã‚’è¿½åŠ 
- æ—¢å­˜ã®`company_address`ãƒ‡ãƒ¼ã‚¿ã‚’`company_address1`ã«è‡ªå‹•ç§»è¡Œ

```sql
-- 1. company_address1ã‚«ãƒ©ãƒ ã‚’è¿½åŠ ï¼ˆæ—¢ã«å­˜åœ¨ã™ã‚‹å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—ï¼‰
ALTER TABLE system_settings
ADD COLUMN IF NOT EXISTS company_address1 TEXT;

-- 2. company_address2ã‚«ãƒ©ãƒ ã‚’è¿½åŠ 
ALTER TABLE system_settings
ADD COLUMN IF NOT EXISTS company_address2 TEXT;

-- 3. æ—¢å­˜ã®company_addressã®ãƒ‡ãƒ¼ã‚¿ã‚’company_address1ã«ç§»è¡Œ
UPDATE system_settings
SET company_address1 = company_address
WHERE company_address IS NOT NULL 
  AND company_address1 IS NULL
  AND EXISTS (
    SELECT 1 FROM information_schema.columns 
    WHERE table_name = 'system_settings' 
    AND column_name = 'company_address'
  );
```

#### 2. ã‚·ã‚¹ãƒ†ãƒ è¨­å®šç”»é¢ã®æ›´æ–°

**ãƒ•ã‚¡ã‚¤ãƒ«**: `app/admin/settings/page.tsx`

- ä½æ‰€å…¥åŠ›æ¬„ã‚’ã€Œä½æ‰€ï¼ˆ1è¡Œç›®ï¼‰ã€ã¨ã€Œä½æ‰€ï¼ˆ2è¡Œç›®ï¼‰ã€ã®2ã¤ã«åˆ†å‰²
- å‹å®šç¾©ã‚’æ›´æ–°ï¼ˆ`company_address` â†’ `company_address1`, `company_address2`ï¼‰

#### 3. ã‚·ã‚¹ãƒ†ãƒ è¨­å®šAPIã®æ›´æ–°

**ãƒ•ã‚¡ã‚¤ãƒ«**: `app/api/admin/settings/route.ts`

- ä½æ‰€1ã¨ä½æ‰€2ã®ä¿å­˜ãƒ»å–å¾—ã«å¯¾å¿œ
- ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã§`company_address1`ã¨`company_address2`ã‚’å‡¦ç†

#### 4. PDFç”ŸæˆAPIã®æ”¹å–„

**ãƒ•ã‚¡ã‚¤ãƒ«**: `app/api/admin/orders/today/pdf/route.ts`

- ä½æ‰€ã‚’2è¡Œã§è¡¨ç¤ºï¼ˆ`company_address1`ã¨`company_address2`ï¼‰
- é•·æ–‡å¯¾å¿œ:
  - ä¼æ¥­å: å¹…ã‚’200pxã«æ‹¡å¤§ã€`ellipsis: false`ã§åˆ‡ã‚‰ãªã„
  - ä½æ‰€: 2è¡Œå¯¾å¿œã€å¹…ã‚’200pxã«æ‹¡å¤§
  - æ¥­è€…å: å¹…ã‚’300pxã«æ‹¡å¤§

### ä½¿ç”¨æ–¹æ³•

1. ã‚·ã‚¹ãƒ†ãƒ è¨­å®šç”»é¢ï¼ˆ`/admin/settings`ï¼‰ã®ã€Œä¼šç¤¾æƒ…å ±ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã€ä½æ‰€ã‚’2è¡Œã«åˆ†ã‘ã¦å…¥åŠ›
2. PDFå‡ºåŠ›æ™‚ã«ã€ä½æ‰€ãŒ2è¡Œã§è¡¨ç¤ºã•ã‚Œã‚‹
3. é•·ã„ä¼æ¥­åã‚„æ¥­è€…åã‚‚æ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹

---

## PDFã«FAXç•ªå·ã‚’è¿½åŠ 

### å®Ÿè£…å†…å®¹

**ãƒ•ã‚¡ã‚¤ãƒ«**: `app/api/admin/orders/today/pdf/route.ts`

- ã‚·ã‚¹ãƒ†ãƒ è¨­å®šã‹ã‚‰`company_fax`ã‚’å–å¾—
- é›»è©±ç•ªå·ã®ä¸‹ã«FAXç•ªå·ã‚’è¡¨ç¤º
- ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ: `FAX: [FAXç•ªå·]`

### PDFã®é€ä¿¡è€…æƒ…å ±ã®è¡¨ç¤ºé †åº

1. ä¼šç¤¾å
2. éƒµä¾¿ç•ªå·
3. ä½æ‰€ï¼ˆ1è¡Œç›®ï¼‰
4. ä½æ‰€ï¼ˆ2è¡Œç›®ï¼‰
5. é›»è©±ç•ªå·
6. **FAXç•ªå·**ï¼ˆæ–°è¦è¿½åŠ ï¼‰

---

## ç›£æŸ»ãƒ­ã‚°ã®å®Œå…¨å®Ÿè£…

### å®Ÿè£…ã®èƒŒæ™¯

æ“ä½œãƒ­ã‚°é–²è¦§ç”»é¢ã¯å®Ÿè£…æ¸ˆã¿ã§ã—ãŸãŒã€ä¸€éƒ¨ã®ç®¡ç†è€…æ“ä½œï¼ˆä¾¡æ ¼æ›´æ–°ã€æ¥­è€…ç®¡ç†ã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç®¡ç†ãªã©ï¼‰ã®ãƒ­ã‚°è¨˜éŒ²ãŒæœªå®Ÿè£…ã§ã—ãŸã€‚ã™ã¹ã¦ã®ç®¡ç†è€…æ“ä½œã‚’ç›£æŸ»ãƒ­ã‚°ã«è¨˜éŒ²ã™ã‚‹ã‚ˆã†ã«å®Ÿè£…ã—ã¾ã—ãŸã€‚

### å®Ÿè£…å†…å®¹

#### è¿½åŠ ã—ãŸãƒ­ã‚°è¨˜éŒ²

1. **ä¾¡æ ¼ç®¡ç†API**
   - `POST /api/admin/prices` - ä¾¡æ ¼ä½œæˆæ™‚ï¼ˆ`price.create`ï¼‰
   - `PUT /api/admin/prices/[id]` - ä¾¡æ ¼æ›´æ–°æ™‚ï¼ˆ`price.update`ï¼‰
   - `DELETE /api/admin/prices/[id]` - ä¾¡æ ¼å‰Šé™¤æ™‚ï¼ˆ`price.delete`ï¼‰

2. **æ¥­è€…ç®¡ç†API**
   - `POST /api/admin/vendors` - æ¥­è€…ä½œæˆæ™‚ï¼ˆ`vendor.create`ï¼‰
   - `PUT /api/admin/vendors/[id]` - æ¥­è€…æ›´æ–°æ™‚ï¼ˆ`vendor.update`ï¼‰
   - `DELETE /api/admin/vendors/[id]` - æ¥­è€…å‰Šé™¤æ™‚ï¼ˆ`vendor.delete`ï¼‰

3. **ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç®¡ç†API**
   - `POST /api/admin/menus` - ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä½œæˆæ™‚ï¼ˆ`menu.create`ï¼‰
   - `PUT /api/admin/menus/[id]` - ãƒ¡ãƒ‹ãƒ¥ãƒ¼æ›´æ–°æ™‚ï¼ˆ`menu.update`ï¼‰
   - `DELETE /api/admin/menus/[id]` - ãƒ¡ãƒ‹ãƒ¥ãƒ¼å‰Šé™¤æ™‚ï¼ˆ`menu.delete`ï¼‰

4. **ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ç®¡ç†API**
   - `PUT /api/admin/calendar` - ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¨­å®šæ›´æ–°æ™‚ï¼ˆ`calendar.update`ï¼‰

5. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†API**
   - `PUT /api/admin/users/[id]` - ãƒ¦ãƒ¼ã‚¶ãƒ¼æ›´æ–°æ™‚ï¼ˆ`user.update`ï¼‰
   - `DELETE /api/admin/users/[id]` - ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤æ™‚ï¼ˆ`user.delete`ï¼‰

6. **ã‚·ã‚¹ãƒ†ãƒ è¨­å®šAPI**
   - `PUT /api/admin/settings` - ã‚·ã‚¹ãƒ†ãƒ è¨­å®šæ›´æ–°æ™‚ï¼ˆ`settings.update`ï¼‰

#### ãƒ­ã‚°è¨˜éŒ²ã®å†…å®¹

å„ãƒ­ã‚°ã«ã¯ä»¥ä¸‹ã‚’å«ã¿ã¾ã™ï¼š

- `actor_id`: å®Ÿè¡Œãƒ¦ãƒ¼ã‚¶ãƒ¼ID
- `action`: ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç¨®åˆ¥ï¼ˆä¾‹: `price.create`, `vendor.update`ï¼‰
- `target_table`: å¯¾è±¡ãƒ†ãƒ¼ãƒ–ãƒ«å
- `target_id`: å¯¾è±¡ãƒ¬ã‚³ãƒ¼ãƒ‰ID
- `details`: æ“ä½œã®è©³ç´°æƒ…å ±ï¼ˆJSONBå½¢å¼ï¼‰
- `ip_address`: å®Ÿè¡Œå…ƒIPã‚¢ãƒ‰ãƒ¬ã‚¹

#### æ—¢ã«å®Ÿè£…æ¸ˆã¿ã®ãƒ­ã‚°è¨˜éŒ²

- æ³¨æ–‡ä½œæˆï¼ˆ`order.create`, `order.create.admin`ï¼‰
- æ³¨æ–‡æ›´æ–°ï¼ˆ`order.update`, `order.update.admin`ï¼‰
- æ³¨æ–‡ã‚­ãƒ£ãƒ³ã‚»ãƒ«ï¼ˆ`order.cancel`, `order.cancel.admin`ï¼‰
- è‡ªå‹•æ³¨æ–‡ï¼ˆ`order.create.auto`ï¼‰

### ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«

- `app/api/admin/prices/route.ts`: ä¾¡æ ¼ä½œæˆæ™‚ã®ãƒ­ã‚°è¨˜éŒ²ã‚’è¿½åŠ 
- `app/api/admin/prices/[id]/route.ts`: ä¾¡æ ¼æ›´æ–°ãƒ»å‰Šé™¤æ™‚ã®ãƒ­ã‚°è¨˜éŒ²ã‚’è¿½åŠ 
- `app/api/admin/vendors/route.ts`: æ¥­è€…ä½œæˆæ™‚ã®ãƒ­ã‚°è¨˜éŒ²ã‚’è¿½åŠ 
- `app/api/admin/vendors/[id]/route.ts`: æ¥­è€…æ›´æ–°ãƒ»å‰Šé™¤æ™‚ã®ãƒ­ã‚°è¨˜éŒ²ã‚’è¿½åŠ 
- `app/api/admin/menus/route.ts`: ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä½œæˆæ™‚ã®ãƒ­ã‚°è¨˜éŒ²ã‚’è¿½åŠ 
- `app/api/admin/menus/[id]/route.ts`: ãƒ¡ãƒ‹ãƒ¥ãƒ¼æ›´æ–°ãƒ»å‰Šé™¤æ™‚ã®ãƒ­ã‚°è¨˜éŒ²ã‚’è¿½åŠ 
- `app/api/admin/calendar/route.ts`: ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¨­å®šæ›´æ–°æ™‚ã®ãƒ­ã‚°è¨˜éŒ²ã‚’è¿½åŠ 
- `app/api/admin/users/[id]/route.ts`: ãƒ¦ãƒ¼ã‚¶ãƒ¼æ›´æ–°ãƒ»å‰Šé™¤æ™‚ã®ãƒ­ã‚°è¨˜éŒ²ã‚’è¿½åŠ 
- `app/api/admin/settings/route.ts`: ã‚·ã‚¹ãƒ†ãƒ è¨­å®šæ›´æ–°æ™‚ã®ãƒ­ã‚°è¨˜éŒ²ã‚’è¿½åŠ 

### ç¢ºèªäº‹é …

- âœ… ã™ã¹ã¦ã®ç®¡ç†è€…æ“ä½œãŒç›£æŸ»ãƒ­ã‚°ã«è¨˜éŒ²ã•ã‚Œã‚‹
- âœ… æ“ä½œãƒ­ã‚°é–²è¦§ç”»é¢ï¼ˆ`/admin/logs`ï¼‰ã§ç¢ºèªå¯èƒ½
- âœ… æ—¢å­˜ã®ãƒ­ã‚°è¨˜éŒ²ï¼ˆæ³¨æ–‡ä½œæˆãƒ»æ›´æ–°ãƒ»ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã€è‡ªå‹•æ³¨æ–‡ï¼‰ã‚‚å¼•ãç¶šãå‹•ä½œ

---

## æŠ€è¡“çš„ãªè©³ç´°

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

- ãƒ­ã‚°è¨˜éŒ²ã®å¤±æ•—ã¯ç„¡è¦–ã—ã¦å‡¦ç†ã‚’ç¶šè¡Œï¼ˆãƒ¡ã‚¤ãƒ³å‡¦ç†ã®æˆåŠŸã‚’å„ªå…ˆï¼‰
- ãƒ­ã‚°è¨˜éŒ²ã‚¨ãƒ©ãƒ¼ã¯ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›

### IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®å–å¾—

- `x-forwarded-for`ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’å„ªå…ˆçš„ã«ä½¿ç”¨
- ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: `x-real-ip`ãƒ˜ãƒƒãƒ€ãƒ¼
- ã©ã¡ã‚‰ã‚‚å–å¾—ã§ããªã„å ´åˆã¯`'unknown'`ã‚’è¨­å®š

---

## æ³¨æ„äº‹é …

### ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè¡Œ

ä½æ‰€2è¡Œåˆ†å‰²æ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€ä»¥ä¸‹ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š

```sql
-- supabase/migrations/058_split_company_address_to_two_columns.sql ã‚’å®Ÿè¡Œ
```

Supabaseãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®SQL Editorã¾ãŸã¯Supabase CLIã§å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

### å¾Œæ–¹äº’æ›æ€§

- æ—¢å­˜ã®`company_address`ã‚«ãƒ©ãƒ ã¯å‰Šé™¤ã›ãšã«æ®‹ã—ã¦ã„ã¾ã™ï¼ˆå¾Œæ–¹äº’æ›æ€§ã®ãŸã‚ï¼‰
- æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã¯è‡ªå‹•çš„ã«`company_address1`ã«ç§»è¡Œã•ã‚Œã¾ã™

---

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [CHANGELOG.md](./CHANGELOG.md) - å¤‰æ›´å±¥æ­´
- [PROGRESS.md](./PROGRESS.md) - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé€²æ—çŠ¶æ³
- [SPEC.md](./SPEC.md) - ã‚·ã‚¹ãƒ†ãƒ ä»•æ§˜æ›¸
- [PDFç”Ÿæˆæ©Ÿèƒ½ã®æ”¹å–„ã¨ç™ºæ³¨æ›¸å½¢å¼ã¸ã®å¤‰æ›´.md](./PDFç”Ÿæˆæ©Ÿèƒ½ã®æ”¹å–„ã¨ç™ºæ³¨æ›¸å½¢å¼ã¸ã®å¤‰æ›´.md) - PDFå‡ºåŠ›æ©Ÿèƒ½ã®è©³ç´°
